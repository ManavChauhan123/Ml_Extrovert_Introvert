<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ML Classification Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <link href="/static/css/style.css" rel="stylesheet" />
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-success">
    <div class="container">
      <a class="navbar-brand" href="#"><i class="fas fa-brain"></i> Classification Dashboard</a>
      <div class="navbar-nav ms-auto">
        <a class="nav-link" href="#classification">Classification</a>
        <a class="nav-link" href="#eda">EDA</a>
        <a class="nav-link" href="#model-comparison">Models</a>
        <a class="nav-link" href="#history">History</a>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <!-- Classification Section -->
    <div id="classification" class="section">
      <div class="card">
        <div class="card-header bg-success text-white">
          <h3><i class="fas fa-search"></i> Make Classification</h3>
        </div>
        <div class="card-body">
          <form id="classificationForm">
            <div id="feature-inputs" class="row"></div>
            <button type="submit" class="btn btn-success mt-3">
              <i class="fas fa-play"></i> Classify
            </button>
          </form>
          <div id="classification-result" class="mt-3"></div>
        </div>
      </div>
    </div>

    <!-- EDA Section -->
    <div id="eda" class="section mt-4">
      <div class="card">
        <div class="card-header bg-info text-white">
          <h3><i class="fas fa-chart-bar"></i> Exploratory Data Analysis</h3>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-3">
              <button class="btn btn-outline-info w-100 mb-2" onclick="showEDAImage('target-distribution')">
                Target Distribution
              </button>
            </div>
            <div class="col-md-3">
              <button class="btn btn-outline-info w-100 mb-2" onclick="showEDAImage('correlation-matrix')">
                Correlation Matrix
              </button>
            </div>
            <div class="col-md-3">
              <button class="btn btn-outline-info w-100 mb-2" onclick="showEDAImage('feature-analysis')">
                Feature Analysis
              </button>
            </div>
            <div class="col-md-3">
              <button class="btn btn-outline-info w-100 mb-2" onclick="showEDAImage('confusion-matrix')">
                Confusion Matrices
              </button>
            </div>
          </div>
          <div id="eda-content" class="mt-3 text-center"></div>
        </div>
      </div>
    </div>

    <!-- Model Comparison Section -->
    <div id="model-comparison" class="section mt-4">
      <div class="card">
        <div class="card-header bg-warning text-dark">
          <h3><i class="fas fa-balance-scale"></i> Model Comparison</h3>
        </div>
        <div class="card-body">
          <p>Model comparison chart or info will appear here...</p>
        </div>
      </div>
    </div>

    <!-- History Section -->
    <div id="history" class="section mt-4">
      <div class="card">
        <div class="card-header bg-secondary text-white">
          <h3><i class="fas fa-history"></i> Classification History</h3>
        </div>
        <div class="card-body">
          <p>Classification history table will appear here...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    async function loadFeatureInputs() {
      const res = await fetch("/model-info");
      const data = await res.json();
      const features = data.feature_names;
      const inputsDiv = document.getElementById("feature-inputs");
      features.forEach((feature) => {
        const col = document.createElement("div");
        col.className = "col-md-4 mb-2";
        col.innerHTML = `
          <label class="form-label">${feature}</label>
          <input type="number" step="any" class="form-control" name="${feature}" required />
        `;
        inputsDiv.appendChild(col);
      });
    }

    document.getElementById("classificationForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      const features = {};
      formData.forEach((value, key) => {
        features[key] = parseFloat(value);
      });

      const res = await fetch("/classify", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ features })
      });

      const result = await res.json();
      const display = `
        <div class="alert alert-info">
          <strong>Predicted:</strong> ${result.predicted_class} <br/>
          <strong>Confidence:</strong> ${(result.confidence * 100).toFixed(2)}% <br/>
        </div>
      `;
      document.getElementById("classification-result").innerHTML = display;
    });

    function showEDAImage(imageName) {
      const container = document.getElementById("eda-content");
      container.innerHTML = `<img src="/static/eda/${imageName}.png" class="img-fluid" alt="${imageName}" />`;
    }

    loadFeatureInputs();
  </script>
</body>
</html>
